name: Generate API Documentation

on:
  push:
    paths:
      - "yaml/**/*.yaml"
      - "yaml/**/*.yml"
  pull_request:
    paths:
      - "yaml/**/*.yaml"
      - "yaml/**/*.yml"
  workflow_dispatch: # Manual trigger

jobs:
  generate_docs:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0 # Required for smart change detection

      - name: Generate API Documentation
        uses: DomoApps/documentation-generator-action@main
        with:
          openai_api_key: ${{ secrets.OPENAI_API_KEY }}
          yaml_input_path: "./yaml"
          output_path: "./docs"
          openai_model: "gpt-4o"
          max_iterations: "5"
          completeness_threshold: "90"
          timeout_minutes: "10"
          # ðŸŽ¯ Smart Features (all enabled by default)
          process_changed_only: "true"      # Only process changed files
          create_pull_request: "true"       # Auto-create PR
          pr_title: "ðŸ“š Update API documentation"  # Fallback (AI will generate better ones)
          # Optional customization
          # template_path: "./custom-template.md"  # Use custom template
          # pr_branch_name: "docs/api-update"      # Custom branch name