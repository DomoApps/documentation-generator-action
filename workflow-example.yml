name: Generate API Documentation

on:
  push:
    paths:
      - "yaml/**/*.yaml"
      - "yaml/**/*.yml"
  pull_request:
    paths:
      - "yaml/**/*.yaml"
      - "yaml/**/*.yml"
  workflow_dispatch: # Manual trigger

jobs:
  generate_docs:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Generate API Documentation
        uses: DomoApps/documentation-generator-action@main
        with:
          openai_api_key: ${{ secrets.OPENAI_API_KEY }}
          yaml_input_path: "./yaml"
          output_path: "./docs"
          template_path: "default" # Uses built-in template, or specify custom path
          openai_model: "gpt-4o"
          max_iterations: "5"
          completeness_threshold: "90"
          timeout_minutes: "10"
          process_changed_only: "true" # Only process changed YAML files
          create_pull_request: "true" # Automatically create PR with results
          pr_title: "ðŸ“š Auto-generated Documentation Update"