# Update docs.json Navigation on Merge
#
# Runs when OpenAPI YAML files are merged to master.
# Regenerates docs.json navigation to include new/changed endpoints.
#
# Use this with sync-with-prs.yml for the PR-based workflow.

name: Update Navigation

# ============================================================================
# CONFIGURATION - Update these values for your setup
# ============================================================================
env:
  DEST_YAML_PATH: openapi/product
  DOCS_JSON_PATH: ./docs.json
  OPENAPI_BASE_PATH: openapi/product
  BASE_BRANCH: master
# ============================================================================

on:
  push:
    branches: [master] # <-- Update if your base branch differs
    paths:
      - "openapi/**/*.yaml"
      - "openapi/**/*.yml"

jobs:
  update-navigation:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4

      - name: Update API Navigation
        uses: DomoApps/documentation-generator-action@main
        with:
          yaml_input_path: "./${{ env.DEST_YAML_PATH }}"
          docs_json_path: "${{ env.DOCS_JSON_PATH }}"
          openapi_base_path: "${{ env.OPENAPI_BASE_PATH }}"

      - name: Commit Updated Navigation
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add "${{ env.DOCS_JSON_PATH }}"
          git diff --staged --quiet || git commit -m "docs: Update API navigation"
          git push
